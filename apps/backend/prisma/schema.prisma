// Prisma Schema para Tinder Laboral MVP

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserType {
  CANDIDATE
  RECRUITER
}

enum WorkType {
  FULL_TIME
  PART_TIME
  FREELANCE
  INTERNSHIP
}

enum JobCategory {
  TECHNOLOGY
  SALES
  ADMINISTRATION
  MARKETING
  DESIGN
  FINANCE
  HR
  OPERATIONS
  HEALTHCARE
  EDUCATION
  CONSTRUCTION
  HOSPITALITY
  MANUFACTURING
  LOGISTICS
  LEGAL
  MEDIA
  OTHER
}

enum WorkModality {
  REMOTE
  ONSITE
  HYBRID
}

enum CompanySize {
  STARTUP       // 1-10
  SMALL         // 11-50
  MEDIUM        // 51-200
  LARGE         // 201-1000
  ENTERPRISE    // 1000+
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  userType      UserType
  verified      Boolean   @default(false)
  active        Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relaciones
  profile       Profile?
  refreshTokens RefreshToken[]

  // Swipes dados por este usuario
  swipesGiven   Swipe[]   @relation("SwipesGiven")

  // Swipes recibidos por este usuario (cuando es candidato)
  swipesReceived Swipe[]  @relation("SwipesReceived")

  // Matches donde este usuario participa
  matchesAsUser1 Match[]  @relation("User1Matches")
  matchesAsUser2 Match[]  @relation("User2Matches")

  // Mensajes enviados
  messagesSent  Message[]

  // Ofertas de trabajo (solo para reclutadores)
  jobOffers     JobOffer[]

  @@index([email])
  @@index([userType])
}

model Profile {
  id              String        @id @default(uuid())
  userId          String        @unique
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Información común
  name            String
  avatar          String?
  bio             String?
  location        String?
  phone           String?

  // Información de candidato
  headline        String?       // Título profesional corto
  currentPosition String?       // Posición/trabajo actual
  skills          String[]      @default([])
  experience      Json?         // [{company, position, years, description}]
  education       String?
  resume          String?       // URL del CV
  workTypes       WorkType[]    @default([])
  categories      JobCategory[] @default([])
  yearsExperience Int?

  // Preferencias de trabajo del candidato
  workModality    WorkModality? // Preferencia: Remoto, Presencial, Híbrido
  availableFrom   DateTime?     // Disponibilidad para empezar
  expectedSalaryMin Int?        // Salario esperado mínimo
  expectedSalaryMax Int?        // Salario esperado máximo
  salaryCurrency  String        @default("USD")

  // Información adicional del candidato
  languages       Json?         // [{language: string, level: string}]
  certifications  String[]      @default([])
  portfolio       String?       // URL del portafolio
  linkedin        String?       // URL de LinkedIn personal
  github          String?       // URL de GitHub

  // Información de reclutador
  companyName     String?
  companyLogo     String?
  companyWebsite  String?
  position        String?       // Cargo del reclutador

  // Información adicional de la empresa (reclutador)
  companyDescription String?    @db.Text // Descripción detallada de la empresa
  companySize     CompanySize?  // Tamaño de la empresa
  industry        String?       // Industria/sector
  foundedYear     Int?          // Año de fundación
  companyLinkedin String?       // LinkedIn de la empresa

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([userId])
}

model JobOffer {
  id              String        @id @default(uuid())
  recruiterId     String
  recruiter       User          @relation(fields: [recruiterId], references: [id], onDelete: Cascade)

  title           String
  description     String        @db.Text
  requirements    String[]      @default([])
  workType        WorkType
  category        JobCategory
  location        String?
  remote          Boolean       @default(false)
  salaryMin       Int?
  salaryMax       Int?
  salaryCurrency  String        @default("USD")

  companyName     String?
  companyVisible  Boolean       @default(true)

  active          Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relaciones
  swipes          Swipe[]
  matches         Match[]

  @@index([recruiterId])
  @@index([category])
  @@index([workType])
  @@index([active])
}

model Swipe {
  id              String        @id @default(uuid())

  // Usuario que hace el swipe
  swiperId        String
  swiper          User          @relation("SwipesGiven", fields: [swiperId], references: [id], onDelete: Cascade)

  // Si es candidato swipeando ofertas
  jobOfferId      String?
  jobOffer        JobOffer?     @relation(fields: [jobOfferId], references: [id], onDelete: Cascade)

  // Si es reclutador swipeando candidatos
  targetUserId    String?
  targetUser      User?         @relation("SwipesReceived", fields: [targetUserId], references: [id], onDelete: Cascade)

  liked           Boolean       // true = right swipe (like), false = left swipe (pass)
  createdAt       DateTime      @default(now())

  @@unique([swiperId, jobOfferId])
  @@unique([swiperId, targetUserId])
  @@index([swiperId])
  @@index([jobOfferId])
  @@index([targetUserId])
}

model Match {
  id              String        @id @default(uuid())

  // Los dos usuarios que hicieron match
  user1Id         String
  user2Id         String
  user1           User          @relation("User1Matches", fields: [user1Id], references: [id], onDelete: Cascade)
  user2           User          @relation("User2Matches", fields: [user2Id], references: [id], onDelete: Cascade)

  // Oferta de trabajo relacionada (si aplica)
  jobOfferId      String?
  jobOffer        JobOffer?     @relation(fields: [jobOfferId], references: [id], onDelete: SetNull)

  active          Boolean       @default(true)
  createdAt       DateTime      @default(now())

  // Relaciones
  messages        Message[]

  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
  @@index([jobOfferId])
}

model Message {
  id              String        @id @default(uuid())

  matchId         String
  match           Match         @relation(fields: [matchId], references: [id], onDelete: Cascade)

  senderId        String
  sender          User          @relation(fields: [senderId], references: [id], onDelete: Cascade)

  content         String        @db.Text
  read            Boolean       @default(false)
  createdAt       DateTime      @default(now())

  @@index([matchId])
  @@index([senderId])
  @@index([createdAt])
}

model RefreshToken {
  id              String        @id @default(uuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  token           String        @unique
  expiresAt       DateTime
  createdAt       DateTime      @default(now())

  @@index([userId])
  @@index([token])
}
